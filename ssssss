import pandas as pd
from tkinter import Tk
from tkinter.filedialog import askopenfilename
import pymysql

def main():
    # 1. íŒŒì¼ ì—´ê¸°
    root = Tk()
    root.withdraw()
    file_path = askopenfilename(
        title="CSV íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”",
        filetypes=[("CSV files", "*.csv")])
    root.destroy()
    # CSV ì½ê¸°
    df = pd.read_csv(file_path)
    print(f"\nğŸ“‚ ë¶ˆëŸ¬ì˜¨ íŒŒì¼: {file_path}\n")
    print(df.head())
    print(df.columns)

    # 2. NaN â†’ None (MySQL NULLë¡œ ë“¤ì–´ê°€ê²Œ)
    df = df.where(pd.notnull(df), None)

    # 3. DB ì—°ê²°
    conn = pymysql.connect(
        host='localhost',
        user='root',
        password='1234',   # ë³¸ì¸ DB ë¹„ë°€ë²ˆí˜¸
        db='test',         # ë³¸ì¸ DB ì´ë¦„
        charset='utf8'
    )
    cursor = conn.cursor()

    # 4. INSERT ì¿¼ë¦¬
    sql = """
    INSERT INTO hospital (name, address, opening_hours, services, avg_rating)
    VALUES (%s, %s, %s, %s, %s)
    """

    count = 0
    for _, row in df.iterrows():
        cursor.execute(sql, (
            row['FCLTY_NM'],          # ì´ë¦„(ì˜ˆì‹œ: ì‹¤ì œ ì»¬ëŸ¼ëª… í™•ì¸ í•„ìš”!)
            row['RDNMADR_NM'],        # ì£¼ì†Œ(ì˜ˆì‹œ)
            row.get('OPER_TIME', ''), # ì˜ì—…ì‹œê°„(ì˜ˆì‹œ)
            row.get('SERVICE', ''),   # ì„œë¹„ìŠ¤(ì˜ˆì‹œ, ì—†ìœ¼ë©´ ''ë¡œ)
            row.get('AVG_RATING', None)  # í‰ì (ì˜ˆì‹œ, ì—†ìœ¼ë©´ None)
        ))
        count += 1

    conn.commit()
    cursor.close()
    conn.close()
    print(f"âœ… ì´ {count}ê°œ ë ˆì½”ë“œë¥¼ hospital í…Œì´ë¸”ì— ì‚½ì…í–ˆìŠµë‹ˆë‹¤.")

if __name__ == "__main__":
    main()  