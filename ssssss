import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
from tkinter import Tk
from tkinter.filedialog import askopenfilename
import re

# âœ… í•œê¸€ í°íŠ¸ ì„¤ì •
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# ğŸ“‚ íŒŒì¼ íƒìƒ‰ê¸° ì—´ê¸°
Tk().withdraw()
file_path = askopenfilename(title="CSV íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”", filetypes=[("CSV files", "*.csv")])
data = pd.read_csv(file_path)

print(f"\nğŸ“‚ ë¶ˆëŸ¬ì˜¨ íŒŒì¼: {file_path}\n")
print(data.head())

# âœ… ì»¬ëŸ¼ëª… ë³€ê²½
data.rename(columns={
    'ì¶œë°œì§€ëª…': 'origin',
    'TM_CD': 'hour',
    'CFTM_AVE_TRFC_QTY': 'total_ride_count'
}, inplace=True)

# âœ… originì—ì„œ ìˆ«ì ì œê±° (ì˜ˆ: 'ê°€ë½1ë™' â†’ 'ê°€ë½ë™')


# âœ… ë™ë³„ Ã— ì‹œê°„ëŒ€ë³„ í•©ì‚°
data_grouped = data.groupby(['origin', 'hour'], as_index=False).sum()

# âœ… ì´ í†µí–‰ëŸ‰ ê¸°ì¤€ ìƒìœ„ 30ê°œ ë™ ì¶”ì¶œ
top_origins = (
    data_grouped.groupby('origin')['total_ride_count']
    .sum()
    .sort_values(ascending=False)
    .head(30)
    .index
)

# âœ… ìƒìœ„ ë™ í•„í„°ë§
filtered_data = data_grouped[data_grouped['origin'].isin(top_origins)]

# âœ… í”¼ë²— í…Œì´ë¸” ìƒì„±
pivot_data = filtered_data.pivot(index='origin', columns='hour', values='total_ride_count')

# âœ… íˆíŠ¸ë§µ ì‹œê°í™”
plt.figure(figsize=(15, 12))
sns.heatmap(pivot_data, cmap='YlGnBu', annot=False, linewidths=.5)

plt.title('ìƒìœ„ 30ê°œ ë™ Ã— ì‹œê°„ëŒ€ë³„ í†µí–‰ëŸ‰ íˆíŠ¸ë§µ', fontsize=20)
plt.xlabel('ì‹œê°„ëŒ€ (Hour)', fontsize=15)
plt.ylabel('ì¶œë°œì§€ (Origin)', fontsize=15)

plt.xticks(fontsize=10)
plt.yticks(fontsize=8)

plt.tight_layout()
plt.show()
