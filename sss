import pandas as pd
from tkinter import Tk
from tkinter.filedialog import askopenfilenames
import pymysql
import os

def main():
    # 1. ì—¬ëŸ¬ íŒŒì¼ ì„ íƒì°½ ë„ìš°ê¸°
    root = Tk()
    root.withdraw()
    file_paths = askopenfilenames(
        title="CSV íŒŒì¼ì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš” (Ctrl ë˜ëŠ” Shiftë¡œ ë‹¤ì¤‘ ì„ íƒ)",
        filetypes=[("CSV files", "*.csv")]
    )
    root.destroy()
    if not file_paths:
        print("íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        return

    # 2. MySQL ì—°ê²°
    conn = pymysql.connect(
        host='localhost',
        user='root',
        password='dbsgusqja1',
        db='test',
        charset='utf8'
    )
    cursor = conn.cursor()

    sql = """
    INSERT INTO Product (name, price, image_url, category)
    VALUES (%s, %s, %s, %s)
    """

    total = 0
    for file_path in file_paths:
        df = pd.read_csv(file_path)
        print(f"\nğŸ“‚ ì„ íƒí•œ íŒŒì¼: {file_path}")
        print(df.head())
        print(df.columns)

        df = df.where(pd.notnull(df), None)
        category = os.path.splitext(os.path.basename(file_path))[0]
        count = 0

        for _, row in df.iterrows():
            price_val = row['price']
            if isinstance(price_val, str):
                price_val = price_val.replace(',', '').replace('ì›', '').strip()
                price_val = float(price_val) if price_val else None

            cursor.execute(sql, (
                row.get('name', None),
                price_val,
                row.get('image_url', None),
                category
            ))
            count += 1
            total += 1

        print(f"âœ… '{category}'ì—ì„œ {count}ê°œ ì‚½ì… ì™„ë£Œ.")

        conn.commit()
    cursor.close() 
    conn.close()
    print(f"\nğŸ”¥ ëª¨ë“  íŒŒì¼ í•©ì³ì„œ ì´ {total}ê°œ ë°ì´í„°ë¥¼ Product í…Œì´ë¸”ì— ì‚½ì…í–ˆìŠµë‹ˆë‹¤.")

