<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìƒí’ˆ ìƒì„¸ë³´ê¸°</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 40px; background-color: #fff8e7; }
    .product { max-width: 600px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); text-align: center; }
    .product img { width: 100%; max-height: 300px; object-fit: contain; display: none; }
    .product h2 { margin-top: 20px; }
    .product p { font-size: 18px; color: #666; }
    .product button { margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; display: none; }
    .product a { display: block; margin-top: 20px; font-weight: bold; color: #333; text-decoration: none; }
  </style>
</head>
<body>
<!-- âœ… ì˜¬ë°”ë¥¸ êµ¬ì¡° -->
<a href="petcon.html">
  <img src="petconnect.png.png" alt="PetConnect ë¡œê³ " width="50">
</a>

<div class="product" id="product-detail">
  <img id="product-img" src="" alt="ìƒí’ˆ ì´ë¯¸ì§€">
  <h2 id="product-name"></h2>
  <p id="product-price"></p>
  <p id="product-category"></p>
  <button id="add-cart-btn" type="button">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
  <a href="javascript:history.back()">â† ëª©ë¡ìœ¼ë¡œ ë’¤ë¡œê°€ê¸°</a>
</div>


<script>
const params = new URLSearchParams(window.location.search);
const productId = params.get("id");
const category = params.get("category");

// âœ… ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ìœ¼ë¡œ í…Œì´ë¸” ê²°ì •
let apiTable = "product";
if (category && category.includes("ì‚¬ë£Œ")) {
  apiTable = "product1";
} else if (category && (category.includes("í•˜ìš°ìŠ¤") || category.includes("ìš©í’ˆ") || category.includes("ì˜ë¥˜"))) {
  apiTable = "product2";
}

// âœ… ìƒí’ˆ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
fetch(`http://127.0.0.1:5000/api/product/${productId}?table=${apiTable}`)
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      document.getElementById("product-detail").innerHTML = "<p>ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
      return;
    }

    // âœ… ìƒí’ˆ ë°ì´í„°ì— í…Œì´ë¸” ì •ë³´ í¬í•¨
    window.productData = { ...data, table: apiTable };

    // ì´ë¯¸ì§€ í‘œì‹œ
    document.getElementById("product-img").src = data.img;
    document.getElementById("product-img").style.display = "block";

    document.getElementById("product-name").textContent = data.name;
    document.getElementById("product-price").textContent = `ê°€ê²©: â‚©${Number(data.price).toLocaleString()}`;
    document.getElementById("product-category").textContent = `ì¹´í…Œê³ ë¦¬: ${data.category}`;

    const cartBtn = document.getElementById("add-cart-btn");
    cartBtn.style.display = "inline-block";
    cartBtn.onclick = addToCart;
  });

// âœ… ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ í•¨ìˆ˜
function addToCart() {
  const username = localStorage.getItem("username");
  if (!username) {
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    return;
  }

  fetch("http://127.0.0.1:5000/api/cart", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username: username,
      product_id: productData.id,
      table: productData.table,  // âœ… í…Œì´ë¸” ì •ë³´ í¬í•¨
      quantity: 1,
      added_at: new Date().toISOString()
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
    } else {
      alert("âŒ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì‹¤íŒ¨: " + data.message);
    }
  })
  .catch(err => {
    console.error(err);
    alert("âŒ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
  });
}
</script>

</body>
</html>
